<!DOCTYPE html>
<html ng-app="neighbr">
<head>
	<link href="../public/css/bootstrap.min.css" rel="stylesheet">
	<link href="../public/css/style.css" rel="stylesheet">
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.19/angular.min.js"></script>
	<script src="../public/js/app.js"></script>
	<script type="text/javascript">
		
		var latitude = 40.23;
		var longitude = -111.65;
		var searchRadius = 800;
		var prevLat = 0;
		var prevLong = 0;
		var prevRadius = 800;
		
		function CheckCoordinate() 
		{
			var watchID = navigator.geolocation.watchPosition(function(position) 
			{
				latitude = position.coords.latitude;
				longitude = position.coords.longitude;
				if(Math.abs(latitude-prevLat) > .0001 || Math.abs(longitude-prevLong) > .0001)//Can play with this threshold value
				{
					prevLat = latitude;
					prevLong = longitude;
					initialize();
				}	
				RefreshMe();
			});
		}
		
		function ChangeRadius()
		{
			searchRadius = document.getElementById("radius").value*1609.34;
			if(Math.abs(searchRadius - prevRadius) > 0)
			{
				prevRadius = searchRadius;
				initialize();
				RefreshMe();
			}
		}
		
		function NewThread() 
		{
			var entry = prompt("Enter your post:");    
			if (entry != null) 
			{
				//Start a new thread with "entry" as its data
			}
		}
		
		function SubmitComment()
		{
			//Access socket.io and refresh this textarea accordingly
		}
		
		function RefreshMe()
		{
			//Request update in data, refresh everything. 
			//Send my variables: longitude, latitude, and searchRadius...maybe one day send user credentials as well
			
		}
		
	</script>
	
	<script id="jsbin-javascript">
		
	</script>
	<script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDV8qVb-dG-Ct4bVbdw8-Cq4_Ax2UTxo1w">
    </script>
	<script type="text/javascript">
		function initialize() 
		{
			var mapOptions = 
			{
				center: { lat: latitude, lng: longitude},
				zoom: 13
			};
			var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
			
			var circleOptions = 
			{
				strokeColor: '#0000FF',
				strokeOpacity: 0.8,
				strokeWeight: 2,
				fillColor: '#0000FF',
				fillOpacity: 0.35,
				map: map,
				center: map.center,
				radius: searchRadius
			};
			var cityCircle = new google.maps.Circle(circleOptions);

		}
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>

<body ng-controller="Controller" onload="CheckCoordinate()">
	<div class="container">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<h1 id="productName">neighbr</h1>
				<div class="row clearfix">
					<div class="col-md-8 column">
						<div>
							<h3>
								Message Board
								<sp style="padding-left:425px"></sp>
								<button onclick="NewThread()" class="btn btn-success">Create New Thread</button>
							</h3> 
						</div>
						<div style="overflow-y:scroll; height:451px;">
							<div id="{{$index}}" ng-click="openRoom($index)" class="label" ng-class="{'new-row': startNewRow($index, 3) }" ng-repeat="item in items">
								<p><message>{{ item.message }}</message></p>
								<username>--{{ item.name }}</username>
							</div>
						</div>
					</div>
					<div class="col-md-4 column">
						<h3>Current Thread</h3>
						<div id="focusBoard" style="overflow-y:scroll; height:210px;"></div>
						<div style="padding-top:0px; padding-bottom:10px">
							<input placeholder="new comment" id="comment" style="height:32px; width:287px;">
							<button onclick="SubmitComment()" class="btn btn-success">Submit</button>
						</div>
						<div id="map-canvas"></div>
						<div>
							<input placeholder="radius in miles" id="radius" style="height:33px; width:232px;">
							<button onclick="ChangeRadius()" class="btn btn-success">Change Radius</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>